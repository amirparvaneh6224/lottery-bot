{"cells":[{"cell_type":"code","source":["\n","TOKEN = \"8271695478:AAF6HrFNMJbnTuzzYrAcXFNSbcf9c7x2WMM\"\n","ADMIN_ID = 57097522 # Ø¢ÛŒØ¯ÛŒ Ø¹Ø¯Ø¯ÛŒ Ø§Ø¯Ù…ÛŒÙ†\n","\n","# Ø³Ø§Ø®Øª ÙØ§ÛŒÙ„ config.py Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ bot.py\n","with open(\"config.py\", \"w\", encoding=\"utf-8\") as f:\n","    f.write(f'TOKEN = \"{TOKEN}\"\\n')\n","    f.write(f'ADMIN_ID = {ADMIN_ID}\\n')\n","\n","print(\"config.py Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ âœ”ï¸\")"],"metadata":{"id":"rSJ66GBm-DjV","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1763291712126,"user_tz":-210,"elapsed":28,"user":{"displayName":"Ø§Ù…ÛŒØ±Ø­Ø³ÛŒÙ† Ù¾Ø±ÙˆØ§Ù†Ù‡","userId":"15899462640055446278"}},"outputId":"0ec82a84-fc0a-4268-f650-1abb86d46b02"},"execution_count":1,"outputs":[{"output_type":"stream","name":"stdout","text":["config.py Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ âœ”ï¸\n"]}]},{"cell_type":"code","execution_count":2,"metadata":{"id":"sXU0tcv_37aL","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1763291722009,"user_tz":-210,"elapsed":9880,"user":{"displayName":"Ø§Ù…ÛŒØ±Ø­Ø³ÛŒÙ† Ù¾Ø±ÙˆØ§Ù†Ù‡","userId":"15899462640055446278"}},"outputId":"7be07542-1738-4987-a36f-7721cc09e80c"},"outputs":[{"output_type":"stream","name":"stdout","text":["\u001b[?25l   \u001b[90mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\u001b[0m \u001b[32m0.0/548.5 kB\u001b[0m \u001b[31m?\u001b[0m eta \u001b[36m-:--:--\u001b[0m\r\u001b[2K   \u001b[90mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\u001b[0m \u001b[32m548.5/548.5 kB\u001b[0m \u001b[31m31.8 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25h\u001b[?25l   \u001b[90mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\u001b[0m \u001b[32m0.0/75.0 kB\u001b[0m \u001b[31m?\u001b[0m eta \u001b[36m-:--:--\u001b[0m\r\u001b[2K   \u001b[90mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\u001b[0m \u001b[32m75.0/75.0 kB\u001b[0m \u001b[31m6.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25h\u001b[31mERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.\n","google-genai 1.49.0 requires httpx<1.0.0,>=0.28.1, but you have httpx 0.25.2 which is incompatible.\n","mcp 1.21.0 requires httpx>=0.27.1, but you have httpx 0.25.2 which is incompatible.\n","firebase-admin 6.9.0 requires httpx[http2]==0.28.1, but you have httpx 0.25.2 which is incompatible.\u001b[0m\u001b[31m\n","\u001b[0m"]}],"source":["# Û±. Ù†ØµØ¨\n","! pip install python-telegram-bot==20.6 tinydb nest_asyncio -q"]},{"cell_type":"code","execution_count":3,"metadata":{"id":"Id_5R-Fh3_Oq","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1763291747378,"user_tz":-210,"elapsed":25355,"user":{"displayName":"Ø§Ù…ÛŒØ±Ø­Ø³ÛŒÙ† Ù¾Ø±ÙˆØ§Ù†Ù‡","userId":"15899462640055446278"}},"outputId":"a074d7a7-f9ca-49df-9a0d-24ed6306589f"},"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}],"source":["# Û². Ù…ÙˆÙ†Øª Ø¯Ø±Ø§ÛŒÙˆ\n","from google.colab import drive\n","drive.mount ( '/content/drive' ,  force_remount= True )"]},{"cell_type":"code","source":["# bot.py - Ø±Ø¨Ø§Øª Ø¨Ø®Øªâ€ŒØ¢Ø²Ù…Ø§ | Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ (Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ + Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ + Ø¨Ø¯ÙˆÙ† Ø¨Ø§Ú¯)\n","import asyncio\n","import logging\n","from datetime import datetime\n","import csv\n","import io\n","from telegram import (\n","    Update, InlineKeyboardButton, InlineKeyboardMarkup\n",")\n","from telegram.ext import (\n","    Application, CommandHandler, MessageHandler, CallbackQueryHandler,\n","    ContextTypes, filters, ConversationHandler\n",")\n","from tinydb import TinyDB, Query\n","import nest_asyncio\n","import os\n","import random\n","\n","# ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù„Ø§Ú¯\n","logging.basicConfig(level=logging.INFO)\n","logger = logging.getLogger(__name__)\n","\n","# --- Ù…Ø±Ø§Ø­Ù„ ---\n","SET_PRIZE, SET_FEE, SET_MAX = range(3)\n","SEND_BROADCAST = 0\n","\n","# Ø¯ÛŒØªØ§Ø¨ÛŒØ³\n","DB_PATH = \"/content/drive/MyDrive/lottery_bot/db.json\"\n","os.makedirs(os.path.dirname(DB_PATH), exist_ok=True)\n","db = TinyDB(DB_PATH)\n","Users = db.table(\"participants\")\n","Settings = db.table(\"settings\")\n","Q = Query()\n","\n","# ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø¯Ù…ÛŒÙ† (TOKEN Ùˆ ADMIN_ID Ø±Ø§ Ø¯Ø± ÙØ§ÛŒÙ„ config.py Ù‚Ø±Ø§Ø± Ø¨Ø¯Ù‡)\n","try:\n","    from config import TOKEN, ADMIN_ID\n","except ImportError:\n","    raise ImportError(\"ÙØ§ÛŒÙ„ config.py Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯! Ù„Ø·ÙØ§Ù‹ TOKEN Ùˆ ADMIN_ID Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.\")\n","\n","# --- Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª ---\n","def load_settings():\n","    s = Settings.get(Q.type == \"lottery\") or {}\n","    return {\n","        \"prize\": s.get(\"prize\", \"Ú¯ÙˆØ´ÛŒ Samsung S24 FE\"),\n","        \"fee\": s.get(\"fee\", \"1,300,000 Ø±ÛŒØ§Ù„\"),\n","        \"max_participants\": s.get(\"max_participants\", 500),\n","        \"card_number\": s.get(\"card_number\", \"6063 7310 8454 7539\"),\n","        \"card_owner\": s.get(\"card_owner\", \"Ø§Ù…ÛŒØ±Ø­Ø³ÛŒÙ† Ù¾Ø±ÙˆØ§Ù†Ù‡\")\n","    }\n","\n","SETTINGS = load_settings()\n","DRAWN = False\n","WINNER = None\n","\n","# --- ØªØ§Ø¨Ø¹ Ø¢Ù…Ø§Ø± Ø²Ù†Ø¯Ù‡ ---\n","def get_live_stats():\n","    total = len(Users.all())\n","    approved = len(Users.search(Q.status == \"approved\"))\n","    pending = len(Users.search(Q.status == \"pending\"))\n","    referrals = sum(u.get(\"referrals\", 0) for u in Users.all())\n","    remaining = SETTINGS[\"max_participants\"] - approved\n","    return {\n","        \"total\": total,\n","        \"approved\": approved,\n","        \"pending\": pending,\n","        \"referrals\": referrals,\n","        \"remaining\": remaining\n","    }\n","\n","# ====================== /start ======================\n","async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):\n","    user = update.effective_user\n","    stats = get_live_stats()\n","\n","    # Ø«Ø¨Øª Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø³Ø§Ø®ØªØ§Ø±)\n","    if not Users.get(Q.id == user.id):\n","        invited_by = None\n","        if context.args:\n","            try:\n","                invited_by = int(context.args[0])\n","            except:\n","                invited_by = None\n","\n","        Users.insert({\n","            \"id\": user.id,\n","            \"name\": user.full_name,\n","            \"username\": user.username,\n","            \"status\": \"registered\",\n","            \"registered_at\": datetime.now().isoformat(),\n","            \"referrals\": 0,\n","            \"invited_by\": invited_by,\n","            \"awaiting_phone\": False,\n","            \"phone\": \"\"\n","        })\n","\n","    kb = [\n","        [InlineKeyboardButton(\"Ø´Ø±Ú©Øª Ø¯Ø± Ù‚Ø±Ø¹Ù‡â€ŒÚ©Ø´ÛŒ\", callback_data=\"join\")],\n","        [InlineKeyboardButton(\"ÙˆØ¶Ø¹ÛŒØª Ù…Ù†\", callback_data=\"status\")],\n","        [InlineKeyboardButton(\"Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ\", callback_data=\"support\")],\n","        [InlineKeyboardButton(\"Ø¯Ø¹ÙˆØª Ø¯ÙˆØ³ØªØ§Ù†\", callback_data=\"invite\")]\n","    ]\n","\n","    # Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø²ÛŒØ¨Ø§ â€” Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ù…ØªÙ† Ù¾Ø§ÛŒÙ‡\n","    temp = await update.message.reply_text(\"Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...\")\n","    await context.bot.send_chat_action(update.effective_chat.id, \"typing\")\n","    await asyncio.sleep(1.2)\n","\n","    await temp.edit_text(\"Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ...\")\n","    await context.bot.send_chat_action(update.effective_chat.id, \"typing\")\n","    await asyncio.sleep(1.0)\n","\n","    await temp.edit_text(\"Ø¯Ø± Ø­Ø§Ù„ Ù†Ù‡Ø§ÛŒÛŒâ€ŒØ³Ø§Ø²ÛŒ...\")\n","    await asyncio.sleep(0.8)\n","\n","    final_text = (\n","        f\"*Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒ Ø¨Ù‡ Ø¨ÙØ®Øªâ€ŒØ¢Ø²Ù…Ø§!*\\n\\n\"\n","        f\"Ø¬Ø§ÛŒÛŒ Ú©Ù‡ Ù‡Ø± Ø³Ø¹ÛŒ ÛŒÚ© ØªØ¬Ø±Ø¨Ù‡â€ŒØ³Øª Ùˆ Ù‡Ø± Ø´Ø§Ù†Ø³ ÛŒÚ© Ø§Ù…ÛŒØ¯.\\n\\n\"\n","        f\"*Ø¬Ø§ÛŒØ²Ù‡ Ø§ÛŒÙ† Ø¯ÙˆØ±Ù‡:* {SETTINGS['prize']}\\n\"\n","        f\"*Ù…Ø¨Ù„Øº Ø´Ø±Ú©Øª:* {SETTINGS['fee']}\\n\\n\"\n","        f\"*Ø¢Ù…Ø§Ø± Ø²Ù†Ø¯Ù‡:*\\n\"\n","        f\"Ú©Ù„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†: `{stats['total']}`\\n\"\n","        f\"ØªØ£ÛŒÛŒØ¯Ø´Ø¯Ù‡: `{stats['approved']}`\\n\"\n","        f\"Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±: `{stats['pending']}`\\n\"\n","        f\"Ø¸Ø±ÙÛŒØª Ø¨Ø§Ù‚ÛŒ: `{stats['remaining']}` Ø§Ø² `{SETTINGS['max_participants']}`\\n\\n\"\n","        f\"Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†\"\n","    )\n","\n","    await temp.edit_text(final_text, reply_markup=InlineKeyboardMarkup(kb), parse_mode=\"Markdown\")\n","\n","# ====================== Ø´Ø±Ú©Øª Ø¯Ø± Ù‚Ø±Ø¹Ù‡â€ŒÚ©Ø´ÛŒ ======================\n","async def join_lottery(update: Update, context: ContextTypes.DEFAULT_TYPE):\n","    query = update.callback_query\n","    await query.answer()\n","    stats = get_live_stats()\n","\n","    text = (\n","        f\"*Ø´Ø±Ú©Øª Ø¯Ø± Ù‚Ø±Ø¹Ù‡â€ŒÚ©Ø´ÛŒ {SETTINGS['prize']}*\\n\\n\"\n","        f\"Ù…Ø¨Ù„Øº Ø´Ø±Ú©Øª: *{SETTINGS['fee']}*\\n\"\n","        f\"Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª:\\n`{SETTINGS['card_number']}`\\n\"\n","        f\"Ø¨Ù‡ Ù†Ø§Ù…: *{SETTINGS['card_owner']}*\\n\\n\"\n","        f\"Ø¸Ø±ÙÛŒØª Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: `{stats['remaining']}` Ø§Ø² `{SETTINGS['max_participants']}`\\n\\n\"\n","        f\"Ù„Ø·ÙØ§Ù‹ Ù¾Ø³ Ø§Ø² ÙˆØ§Ø±ÛŒØ²ØŒ Ø±Ø³ÛŒØ¯ Ù¾Ø±Ø¯Ø§Ø®Øª Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:\"\n","    )\n","    kb = [[InlineKeyboardButton(\"Ø§Ø±Ø³Ø§Ù„ Ø±Ø³ÛŒØ¯\", callback_data=\"send_receipt\")]]\n","\n","    await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(kb), parse_mode=\"Markdown\")\n","\n","# ====================== Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø±Ø³ÛŒØ¯ ======================\n","async def prepare_receipt(update: Update, context: ContextTypes.DEFAULT_TYPE):\n","    query = update.callback_query\n","    await query.answer()\n","    context.user_data[\"awaiting_receipt\"] = True\n","    stats = get_live_stats()\n","    await query.edit_message_text(\n","        f\"Ù„Ø·ÙØ§Ù‹ *Ø¹Ú©Ø³ Ø±Ø³ÛŒØ¯ Ù¾Ø±Ø¯Ø§Ø®Øª* Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.\\n\\n\"\n","        f\"Ø¢Ù…Ø§Ø± Ø²Ù†Ø¯Ù‡: `{stats['approved']}` ØªØ£ÛŒÛŒØ¯ | `{stats['pending']}` Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±\",\n","        parse_mode=\"Markdown\"\n","    )\n","\n","# ====================== Ø¯Ø±ÛŒØ§ÙØª Ø±Ø³ÛŒØ¯ ======================\n","async def handle_receipt(update: Update, context: ContextTypes.DEFAULT_TYPE):\n","    if not context.user_data.get(\"awaiting_receipt\"):\n","        return\n","    user = update.effective_user\n","    if not update.message.photo:\n","        await update.message.reply_text(\"Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ø¹Ú©Ø³ ÙˆØ§Ø¶Ø­ Ø§Ø² Ø±Ø³ÛŒØ¯ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.\")\n","        context.user_data[\"awaiting_receipt\"] = False\n","        return\n","\n","    photo = update.message.photo[-1]\n","    f = await photo.get_file()\n","\n","    caption = f\"*Ø±Ø³ÛŒØ¯ Ø¬Ø¯ÛŒØ¯*\\nØ§Ø²: @{user.username or 'Ù†Ø¯Ø§Ø±Ø¯'}\\nÙ†Ø§Ù…: {user.full_name}\\nID: `{user.id}`\"\n","    kb = [\n","        [InlineKeyboardButton(\"ØªØ£ÛŒÛŒØ¯\", callback_data=f\"ok_{user.id}\"),\n","         InlineKeyboardButton(\"Ø±Ø¯\", callback_data=f\"no_{user.id}\")]\n","    ]\n","    await context.bot.send_photo(ADMIN_ID, f.file_id, caption=caption, reply_markup=InlineKeyboardMarkup(kb), parse_mode=\"Markdown\")\n","\n","    Users.update({\"status\": \"pending\"}, Q.id == user.id)\n","    context.user_data[\"awaiting_receipt\"] = False\n","    await update.message.reply_text(\"Ø±Ø³ÛŒØ¯ Ø´Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯ Ùˆ *Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯* Ø§Ø³Øª.\", parse_mode=\"Markdown\")\n","\n","# ====================== Ø¯Ø±ÛŒØ§ÙØª Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ ======================\n","async def handle_phone(update: Update, context: ContextTypes.DEFAULT_TYPE):\n","    user_id = update.effective_user.id\n","    user_rec = Users.get(Q.id == user_id)\n","    if not user_rec:\n","        return\n","\n","    if not user_rec.get(\"awaiting_phone\"):\n","        return\n","\n","    phone = (update.message.text or \"\").strip()\n","    if not phone:\n","        await update.message.reply_text(\"Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ø®Ø§Ù„ÛŒ Ø§Ø³ØªØŒ Ù„Ø·ÙØ§Ù‹ Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.\")\n","        return\n","\n","    cleaned = phone.replace(\"+\", \"\").replace(\" \", \"\").replace(\"-\", \"\")\n","    if not cleaned.isdigit():\n","        await update.message.reply_text(\"Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª. ÙÙ‚Ø· Ø§Ø² Ø§Ø¹Ø¯Ø§Ø¯ØŒ +ØŒ ÙØ§ØµÙ„Ù‡ ÛŒØ§ Ø®Ø· ØªÛŒØ±Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.\")\n","        return\n","\n","    Users.update({\n","        \"status\": \"approved\",\n","        \"phone\": phone,\n","        \"approved_at\": datetime.now().isoformat(),\n","        \"awaiting_phone\": False\n","    }, Q.id == user_id)\n","\n","    try:\n","        await update.message.reply_text(\"âœ… Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ø´Ù…Ø§ Ø«Ø¨Øª Ø´Ø¯ Ùˆ Ø´Ù…Ø§ ÙˆØ§Ø±Ø¯ Ù‚Ø±Ø¹Ù‡â€ŒÚ©Ø´ÛŒ Ø´Ø¯ÛŒØ¯. Ù…ÙˆÙÙ‚ Ø¨Ø§Ø´ÛŒØ¯!\")\n","    except:\n","        pass\n","\n","# ====================== ÙˆØ¶Ø¹ÛŒØª Ù…Ù† ======================\n","async def show_status(update: Update, context: ContextTypes.DEFAULT_TYPE):\n","    query = update.callback_query\n","    await query.answer()\n","    user = Users.get(Q.id == query.from_user.id) or {}\n","    status = user.get(\"status\", \"registered\")\n","    stats = get_live_stats()\n","\n","    if status == \"approved\":\n","        text = f\"*ÙˆØ¶Ø¹ÛŒØª Ø´Ù…Ø§*\\n\\nØ«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø´Ù…Ø§ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯!\\n\\n\"\n","    elif status == \"pending\":\n","        text = f\"*ÙˆØ¶Ø¹ÛŒØª Ø´Ù…Ø§*\\n\\nØ±Ø³ÛŒØ¯ Ø´Ù…Ø§ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯ Ø§Ø³Øª.\\n\\n\"\n","    elif status == \"rejected\":\n","        text = f\"*ÙˆØ¶Ø¹ÛŒØª Ø´Ù…Ø§*\\n\\nØ±Ø³ÛŒØ¯ Ø´Ù…Ø§ Ø±Ø¯ Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.\\n\\n\"\n","    else:\n","        text = f\"*ÙˆØ¶Ø¹ÛŒØª Ø´Ù…Ø§*\\n\\nØ´Ù…Ø§ Ù‡Ù†ÙˆØ² Ø¯Ø± Ù‚Ø±Ø¹Ù‡â€ŒÚ©Ø´ÛŒ Ø´Ø±Ú©Øª Ù†Ú©Ø±Ø¯ÛŒØ¯!\\nØ¨Ø±Ø§ÛŒ Ø´Ø±Ú©ØªØŒ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Â«Ø´Ø±Ú©Øª Ø¯Ø± Ù‚Ø±Ø¹Ù‡â€ŒÚ©Ø´ÛŒÂ» Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.\\n\\n\"\n","\n","    text += (\n","        f\"Ø¢Ù…Ø§Ø± Ø²Ù†Ø¯Ù‡:\\n\"\n","        f\"âœ… ØªØ£ÛŒÛŒØ¯Ø´Ø¯Ù‡: `{stats['approved']}`\\n\"\n","        f\"ğŸŸ Ø¸Ø±ÙÛŒØª Ø¨Ø§Ù‚ÛŒ: `{stats['remaining']}` Ø§Ø² `{SETTINGS['max_participants']}`\"\n","    )\n","\n","    await query.edit_message_text(text, parse_mode=\"Markdown\")\n","\n","# ====================== Ø¯Ø¹ÙˆØª Ø¯ÙˆØ³ØªØ§Ù† ======================\n","async def invite(update: Update, context: ContextTypes.DEFAULT_TYPE):\n","    query = update.callback_query\n","    await query.answer()\n","    user_id = query.from_user.id\n","    invite_link = f\"https://t.me/{context.bot.username}?start={user_id}\"\n","    await query.edit_message_text(\n","        f\"*Ø¯Ø¹ÙˆØª Ø¯ÙˆØ³ØªØ§Ù†*\\n\\n\"\n","        f\"Ø§ÛŒÙ† Ù„ÛŒÙ†Ú© Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ³ØªØ§Ù†ØªØ§Ù† Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:\\n`{invite_link}`\\n\\n\"\n","        f\"Ù‡Ø± Ú©Ø³ÛŒ Ø¨Ø§ Ù„ÛŒÙ†Ú© Ø´Ù…Ø§ ÙˆØ§Ø±Ø¯ Ø±Ø¨Ø§Øª Ø´ÙˆØ¯ Ø¨Ù‡ Ù„ÛŒØ³Øª Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯\",\n","        parse_mode=\"Markdown\"\n","    )\n","\n","# ====================== Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ======================\n","async def support(update: Update, context: ContextTypes.DEFAULT_TYPE):\n","    query = update.callback_query\n","    await query.answer()\n","    context.user_data[\"support_mode\"] = True\n","    stats = get_live_stats()\n","    await query.edit_message_text(\n","        f\"*Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ÙØ¹Ø§Ù„ Ø´Ø¯!*\\n\\n\"\n","        f\"Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯. Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ† Ù…ÛŒâ€ŒØ±Ø³Ø¯.\\n\\n\"\n","        f\"Ø¢Ù…Ø§Ø±: `{stats['approved']}` ØªØ£ÛŒÛŒØ¯ | `{stats['pending']}` Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±\",\n","        parse_mode=\"Markdown\"\n","    )\n","\n","async def handle_support_message(update: Update, context: ContextTypes.DEFAULT_TYPE):\n","    if not context.user_data.get(\"support_mode\"):\n","        return\n","    await context.bot.forward_message(ADMIN_ID, update.effective_user.id, update.message.message_id)\n","    await update.message.reply_text(\"Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ† Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.\")\n","    context.user_data[\"support_mode\"] = False\n","\n","# ====================== Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ† ======================\n","async def admin_panel(update: Update, context: ContextTypes.DEFAULT_TYPE):\n","    if update.effective_user.id != ADMIN_ID:\n","        await update.message.reply_text(\"Ø¯Ø³ØªØ±Ø³ÛŒ ØºÛŒØ±Ù…Ø¬Ø§Ø².\")\n","        return\n","\n","    stats = get_live_stats()\n","    kb = [\n","        [InlineKeyboardButton(\"Ø§Ø¬Ø±Ø§ÛŒ Ù‚Ø±Ø¹Ù‡â€ŒÚ©Ø´ÛŒ\", callback_data=\"draw\")],\n","        [InlineKeyboardButton(\"Ø±Ø³ÛŒØ¯Ù‡Ø§ÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±\", callback_data=\"view_pending\")],\n","        [InlineKeyboardButton(\"Ø®Ø±ÙˆØ¬ÛŒ CSV\", callback_data=\"export_csv\")],\n","        [InlineKeyboardButton(\"Ù‚Ø±Ø¹Ù‡â€ŒÚ©Ø´ÛŒ Ø¬Ø¯ÛŒØ¯\", callback_data=\"new_lottery\")],\n","        [InlineKeyboardButton(\"Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ù‡Ù…Ù‡\", callback_data=\"broadcast\")]\n","    ]\n","    await update.message.reply_text(\n","        f\"*Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ†*\\n\\n\"\n","        f\"Ø¬Ø§ÛŒØ²Ù‡ ÙØ¹Ù„ÛŒ: `{SETTINGS['prize']}`\\n\"\n","        f\"Ù…Ø¨Ù„Øº: `{SETTINGS['fee']}`\\n\"\n","        f\"Ø­Ø¯Ø§Ú©Ø«Ø±: `{SETTINGS['max_participants']}`\\n\\n\"\n","        f\"Ø¢Ù…Ø§Ø± Ø²Ù†Ø¯Ù‡:\\n\"\n","        f\"Ú©Ù„: `{stats['total']}` | ØªØ£ÛŒÛŒØ¯: `{stats['approved']}` | Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±: `{stats['pending']}`\\n\"\n","        f\"Ø¸Ø±ÙÛŒØª Ø¨Ø§Ù‚ÛŒ: `{stats['remaining']}`\",\n","        reply_markup=InlineKeyboardMarkup(kb),\n","        parse_mode=\"Markdown\"\n","    )\n","\n","# ====================== Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ù‡Ù…Ù‡ ======================\n","async def broadcast(update: Update, context: ContextTypes.DEFAULT_TYPE):\n","    query = update.callback_query\n","    await query.answer()\n","    await query.edit_message_text(\"Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ù‡Ù…Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:\")\n","    return SEND_BROADCAST\n","\n","async def send_broadcast(update: Update, context: ContextTypes.DEFAULT_TYPE):\n","    message = update.message.text\n","    sent = 0\n","    for u in Users.all():\n","        try:\n","            await context.bot.send_message(u[\"id\"], message, parse_mode=\"Markdown\")\n","            sent += 1\n","        except:\n","            pass\n","    await update.message.reply_text(f\"Ù¾ÛŒØ§Ù… Ø¨Ù‡ `{sent}` Ù†ÙØ± Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯!\")\n","    return ConversationHandler.END\n","\n","# ====================== ØªÙ†Ø¸ÛŒÙ… Ù‚Ø±Ø¹Ù‡â€ŒÚ©Ø´ÛŒ Ø¬Ø¯ÛŒØ¯ ======================\n","async def new_lottery(update: Update, context: ContextTypes.DEFAULT_TYPE):\n","    query = update.callback_query\n","    await query.answer()\n","    await query.edit_message_text(\"Ù†Ø§Ù… Ø¬Ø§ÛŒØ²Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:\")\n","    return SET_PRIZE\n","\n","async def set_prize(update: Update, context: ContextTypes.DEFAULT_TYPE):\n","    context.user_data[\"prize\"] = update.message.text\n","    await update.message.reply_text(\"Ù…Ø¨Ù„Øº Ø´Ø±Ú©Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:\")\n","    return SET_FEE\n","\n","async def set_fee(update: Update, context: ContextTypes.DEFAULT_TYPE):\n","    context.user_data[\"fee\"] = update.message.text\n","    await update.message.reply_text(\"Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ¹Ø¯Ø§Ø¯ Ø´Ø±Ú©Øªâ€ŒÚ©Ù†Ù†Ø¯Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:\")\n","    return SET_MAX\n","\n","async def set_max(update: Update, context: ContextTypes.DEFAULT_TYPE):\n","    global SETTINGS, DRAWN\n","    try:\n","        max_part = int(update.message.text)\n","        SETTINGS.update({\n","            \"prize\": context.user_data[\"prize\"],\n","            \"fee\": context.user_data[\"fee\"],\n","            \"max_participants\": max_part\n","        })\n","        Settings.upsert(SETTINGS, Q.type == \"lottery\")\n","        DRAWN = False\n","        Users.update({\"status\": \"registered\"})\n","        await update.message.reply_text(\"Ù‚Ø±Ø¹Ù‡â€ŒÚ©Ø´ÛŒ Ø¬Ø¯ÛŒØ¯ ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯!\")\n","    except:\n","        await update.message.reply_text(\"Ø®Ø·Ø§! Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.\")\n","    return ConversationHandler.END\n","\n","# ====================== callback Ø§Ø¯Ù…ÛŒÙ† ======================\n","async def admin_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):\n","    global DRAWN, WINNER\n","    query = update.callback_query\n","    await query.answer()\n","\n","    if query.from_user.id != ADMIN_ID:\n","        return\n","\n","    data = query.data\n","\n","    if data.startswith(\"ok_\"):\n","        uid = int(data.split(\"_\")[1])\n","        Users.update({\"status\": \"awaiting_phone\", \"awaiting_phone\": True}, Q.id == uid)\n","        try:\n","            await context.bot.send_message(\n","                uid,\n","                \"Ø±Ø³ÛŒØ¯ Ø´Ù…Ø§ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯ âœ…\\n\\nÙ„Ø·ÙØ§Ù‹ Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯ ØªØ§ ÙˆØ§Ø±Ø¯ Ù‚Ø±Ø¹Ù‡â€ŒÚ©Ø´ÛŒ Ø´ÙˆÛŒØ¯.\",\n","                parse_mode=\"Markdown\"\n","            )\n","        except:\n","            pass\n","        try:\n","            await query.edit_message_caption(caption=\"ØªØ£ÛŒÛŒØ¯ Ø´Ø¯. Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ú©Ø§Ø±Ø¨Ø±.\", reply_markup=None)\n","        except:\n","            pass\n","\n","    elif data.startswith(\"no_\"):\n","        uid = int(data.split(\"_\")[1])\n","        Users.update({\"status\": \"rejected\", \"awaiting_phone\": False}, Q.id == uid)\n","        await context.bot.send_message(uid, \"Ø±Ø³ÛŒØ¯ Ø´Ù…Ø§ Ø±Ø¯ Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.\")\n","        try:\n","            await query.edit_message_caption(caption=\"Ø±Ø¯ Ø´Ø¯.\", reply_markup=None)\n","        except:\n","            pass\n","\n","    elif data == \"draw\":\n","        if DRAWN:\n","            await query.edit_message_text(\"Ù‚Ø±Ø¹Ù‡â€ŒÚ©Ø´ÛŒ Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡!\")\n","            return\n","        approved = Users.search(Q.status == \"approved\")\n","        if not approved:\n","            await query.edit_message_text(\"Ù‡ÛŒÚ† Ø´Ø±Ú©Øªâ€ŒÚ©Ù†Ù†Ø¯Ù‡â€ŒØ§ÛŒ Ù†ÛŒØ³Øª.\")\n","            return\n","        WINNER = random.choice(approved)\n","        kb = [[InlineKeyboardButton(\"ØªØ£ÛŒÛŒØ¯ Ø¨Ø±Ù†Ø¯Ù‡\", callback_data=\"confirm_winner\")]]\n","        winner_username = WINNER.get(\"username\") or \"\"\n","        username_display = f\"@{winner_username}\" if winner_username else \"Ù†Ø¯Ø§Ø±Ø¯\"\n","        winner_id = WINNER.get(\"id\")\n","        id_display = f\"`{winner_id}`\" if winner_id else \"Ù†Ø¯Ø§Ø±Ø¯\"\n","        phone = WINNER.get(\"phone\", \"Ù†Ø¯Ø§Ø±Ø¯\")\n","\n","        await query.edit_message_text(\n","            f\"Ø¨Ø±Ù†Ø¯Ù‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ: *{WINNER['name']}*\\n\"\n","            f\"Ø¢ÛŒØ¯ÛŒ: {id_display}\\n\"\n","            f\"ÛŒÙˆØ²Ø±Ù†ÛŒÙ…: {username_display}\\n\"\n","            f\"Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³: `{phone}`\",\n","            reply_markup=InlineKeyboardMarkup(kb), parse_mode=\"Markdown\"\n","        )\n","\n","    elif data == \"confirm_winner\":\n","        if not WINNER:\n","            return\n","        DRAWN = True\n","        winner_id = WINNER.get(\"id\")\n","        winner_name = WINNER.get(\"name\", \"Ù†Ø¯Ø§Ø±Ø¯\")\n","        winner_username = WINNER.get(\"username\") or \"\"\n","        winner_phone = WINNER.get(\"phone\", \"Ù†Ø¯Ø§Ø±Ø¯\")\n","\n","        try:\n","            await context.bot.send_message(\n","                winner_id,\n","                f\"ØªØ¨Ø±ÛŒÚ© ÙˆÛŒÚ˜Ù‡ {winner_name}!\\n\\nØ´Ù…Ø§ Ø¨Ø±Ù†Ø¯Ù‡ *{SETTINGS['prize']}* Ø´Ø¯ÛŒØ¯!\\n\\nØ¨Ø±Ø§ÛŒ Ù‡Ù…Ø§Ù‡Ù†Ú¯ÛŒ Ø¨Ø§ Ø§Ø¯Ù…ÛŒÙ† ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯.\",\n","                parse_mode=\"Markdown\"\n","            )\n","        except:\n","            pass\n","\n","        for u in Users.all():\n","            if u.get(\"id\") == winner_id:\n","                continue\n","            try:\n","                uname = winner_username or \"Ù†Ø¯Ø§Ø±Ø¯\"\n","                id_disp = f\"`{winner_id}`\" if winner_id else \"Ù†Ø¯Ø§Ø±Ø¯\"\n","                await context.bot.send_message(\n","                    u[\"id\"],\n","                    f\"*Ù†ØªÛŒØ¬Ù‡ Ù‚Ø±Ø¹Ù‡â€ŒÚ©Ø´ÛŒ {SETTINGS['prize']}*\\n\\n\"\n","                    f\"Ø¨Ø±Ù†Ø¯Ù‡: *{winner_name}*\\n\"\n","                    f\"Ø¢ÛŒØ¯ÛŒ: {id_disp}\\n\"\n","                    f\"ÛŒÙˆØ²Ø±Ù†ÛŒÙ…: @{uname if uname != 'Ù†Ø¯Ø§Ø±Ø¯' else 'Ù†Ø¯Ø§Ø±Ø¯'}\\n\\n\"\n","                    f\"Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ Ø§ÛŒÙ† Ø¨Ø§Ø± Ø¨Ø±Ù†Ø¯Ù‡ Ù†Ø´Ø¯ÛŒØ¯ØŒ Ø§Ù…Ø§ Ø¯Ø± Ø¯ÙˆØ± Ø¨Ø¹Ø¯ÛŒ Ø´Ø§Ù†Ø³ Ø¨Ø§ Ø´Ù…Ø§ Ø®ÙˆØ§Ù‡Ø¯ Ø¨ÙˆØ¯!\",\n","                    parse_mode=\"Markdown\"\n","                )\n","            except:\n","                pass\n","\n","        id_disp_final = f\"`{winner_id}`\" if winner_id else \"Ù†Ø¯Ø§Ø±Ø¯\"\n","        uname_final = f\"@{winner_username}\" if winner_username else \"Ù†Ø¯Ø§Ø±Ø¯\"\n","        await query.edit_message_text(\n","            f\"Ø¨Ø±Ù†Ø¯Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¹Ù„Ø§Ù… Ø´Ø¯!\\n\"\n","            f\"{winner_name} ({id_disp_final}) â€” {uname_final}\\n\"\n","            f\"Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³: `{winner_phone}`\"\n","        )\n","\n","    elif data == \"view_pending\":\n","        pendings = Users.search(Q.status == \"pending\")\n","        if not pendings:\n","            await query.edit_message_text(\"Ù‡ÛŒÚ† Ø±Ø³ÛŒØ¯ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±ÛŒ Ù†ÛŒØ³Øª.\")\n","            return\n","        txt = \"*Ø±Ø³ÛŒØ¯Ù‡Ø§ÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±*:\\n\\n\" + \"\\n\".join([f\"â€¢ `{p['id']}` â€” {p['name']}\" for p in pendings])\n","        await query.edit_message_text(txt, parse_mode=\"Markdown\")\n","\n","    elif data == \"export_csv\":\n","        output = io.StringIO()\n","        writer = csv.writer(output)\n","        writer.writerow([\"ID\", \"Ù†Ø§Ù…\", \"ÛŒÙˆØ²Ø±Ù†ÛŒÙ…\", \"ÙˆØ¶Ø¹ÛŒØª\", \"Ø¯Ø¹ÙˆØªâ€ŒÙ‡Ø§\", \"ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª\", \"ØªØ§Ø±ÛŒØ® ØªØ£ÛŒÛŒØ¯\", \"Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³\"])\n","        for u in Users.all():\n","            writer.writerow([u[\"id\"], u[\"name\"], u.get(\"username\", \"\"), u[\"status\"], u.get(\"referrals\", 0), u.get(\"registered_at\", \"\"), u.get(\"approved_at\", \"\"), u.get(\"phone\", \"\")])\n","        csv_bytes = output.getvalue().encode(\"utf-8\")\n","        await context.bot.send_document(ADMIN_ID, document=csv_bytes, filename=\"participants.csv\", caption=\"Ø®Ø±ÙˆØ¬ÛŒ CSV\")\n","        await query.edit_message_text(\"ÙØ§ÛŒÙ„ CSV Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.\")\n","\n","# ====================== main ======================\n","async def main():\n","    app = Application.builder().token(TOKEN).build()\n","\n","    conv_new_lottery = ConversationHandler(\n","        entry_points=[CallbackQueryHandler(new_lottery, pattern=\"^new_lottery$\")],\n","        states={\n","            SET_PRIZE: [MessageHandler(filters.TEXT & ~filters.COMMAND, set_prize)],\n","            SET_FEE: [MessageHandler(filters.TEXT & ~filters.COMMAND, set_fee)],\n","            SET_MAX: [MessageHandler(filters.TEXT & ~filters.COMMAND, set_max)],\n","        },\n","        fallbacks=[]\n","    )\n","    conv_broadcast = ConversationHandler(\n","        entry_points=[CallbackQueryHandler(broadcast, pattern=\"^broadcast$\")],\n","        states={SEND_BROADCAST: [MessageHandler(filters.TEXT & ~filters.COMMAND, send_broadcast)]},\n","        fallbacks=[]\n","    )\n","\n","    app.add_handler(conv_new_lottery)\n","    app.add_handler(conv_broadcast)\n","    app.add_handler(CommandHandler(\"start\", start))\n","    app.add_handler(CommandHandler(\"Amir6224\", admin_panel))\n","\n","    app.add_handler(CallbackQueryHandler(admin_callback, pattern=\"^(ok_|no_).*$|^(draw|confirm_winner|view_pending|export_csv)$\"))\n","    app.add_handler(CallbackQueryHandler(join_lottery, pattern=\"^join$\"))\n","    app.add_handler(CallbackQueryHandler(prepare_receipt, pattern=\"^send_receipt$\"))\n","    app.add_handler(CallbackQueryHandler(show_status, pattern=\"^status$\"))\n","    app.add_handler(CallbackQueryHandler(support, pattern=\"^support$\"))\n","    app.add_handler(CallbackQueryHandler(invite, pattern=\"^invite$\"))\n","    app.add_handler(MessageHandler(filters.PHOTO, handle_receipt))\n","\n","    # Ù‡Ù†Ø¯Ù„Ø± ØªØ±Ú©ÛŒØ¨ÛŒ Ø¨Ø±Ø§ÛŒ Ù…ØªÙ†: Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ â†’ Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³\n","    async def handle_text(update: Update, context: ContextTypes.DEFAULT_TYPE):\n","        user_id = update.effective_user.id\n","        user_rec = Users.get(Q.id == user_id)\n","\n","        # 1. Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ\n","        if context.user_data.get(\"support_mode\"):\n","            await handle_support_message(update, context)\n","            return\n","\n","        # 2. Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³\n","        if user_rec and user_rec.get(\"awaiting_phone\"):\n","            await handle_phone(update, context)\n","            return\n","\n","    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_text))\n","\n","    logger.info(\"Ø±Ø¨Ø§Øª Ø¨Ø®Øªâ€ŒØ¢Ø²Ù…Ø§ Ø´Ø±ÙˆØ¹ Ø´Ø¯...\")\n","    await app.run_polling(drop_pending_updates=False)\n","\n","# ====================== Ø§Ø¬Ø±Ø§ Ø¯Ø± Colab ======================\n","nest_asyncio.apply()\n","\n","try:\n","    await main()\n","except RuntimeError:\n","    loop = asyncio.get_event_loop()\n","    loop.create_task(main())"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"CVIeQWhL-eH2","outputId":"e2de904d-5ad1-4a74-d2c3-5b6a11d7204a"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stderr","text":["/tmp/ipython-input-2714776262.py:480: PTBUserWarning: If 'per_message=False', 'CallbackQueryHandler' will not be tracked for every message. Read this FAQ entry to learn more about the per_* settings: https://github.com/python-telegram-bot/python-telegram-bot/wiki/Frequently-Asked-Questions#what-do-the-per_-settings-in-conversationhandler-do.\n","  conv_new_lottery = ConversationHandler(\n","/tmp/ipython-input-2714776262.py:489: PTBUserWarning: If 'per_message=False', 'CallbackQueryHandler' will not be tracked for every message. Read this FAQ entry to learn more about the per_* settings: https://github.com/python-telegram-bot/python-telegram-bot/wiki/Frequently-Asked-Questions#what-do-the-per_-settings-in-conversationhandler-do.\n","  conv_broadcast = ConversationHandler(\n"]}]}],"metadata":{"colab":{"provenance":[],"authorship_tag":"ABX9TyMYzKPWPKCk5HvR8pgzBX+D"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}